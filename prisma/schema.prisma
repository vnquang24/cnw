//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("")
}

generator client {
  provider = "prisma-client-js"
}

enum PermissionName {
  AdministrativeUnit
  Category
  Disaster
  Media
  RescueTypeOnDisaster
  Province
  District
  Commune
  DisasterType
  PriorityLevel
  EmergencyLevel
  DataField
  RescueType
  User
  UserGroup
  Permission
  Zone
  Coordinate
  Device
  RefreshToken
}

enum UserRole {
  ADMIN
  USER
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum CourseStatus {
  ACTIVE
  INACTIVE
}

enum EnrolmentStatus {
  PENDING
  APPROVED
  REJECTED
  IN_PROGRESS
  COMPLETED
}

enum LessonStatus {
  TODO
  DOING
  PASS
  FAIL
}

enum WordType {
  NOUN
  PRONOUN
  VERB
  ADJECTIVE
  ADVERB
  PREPOSITION
  CONJUNCTION
  INTERJECTION
}

enum QuestionType {
  SINGLE_CHOICE
  MULTIPLE_CHOICE
  ESSAY
}

enum ComponentType {
  WORD
  TEST
  PARAGRAPH
  VIDEO
}

enum TestResultStatus {
  PENDING
  PASSED
  FAILED
}

enum PermissionType {
  CREATE
  READ
  UPDATE
  DELETE
}

enum MediaType {
  IMAGE
  VIDEO
  AUDIO
}

model Course {
  id                  String               @id() @default(cuid())
  description         String               @default("")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt()
  deleted             DateTime?
  title               String               @db.VarChar(255)
  createdBy           String?
  duration            Int
  level               CourseLevel          @default(BEGINNER)
  status              CourseStatus         @default(ACTIVE)
  creator             User?                @relation("CourseCreator", fields: [createdBy], references: [id])
  lessons             Lesson[]
  userCourses         UserCourse[]
  adminCourseManagers AdminCourseManager[]
}

model Lesson {
  id          String       @id() @default(cuid())
  description String       @default("")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt()
  deleted     DateTime?
  courseId    String
  title       String       @db.VarChar(255)
  position    Int
  createdBy   String?
  course      Course       @relation(fields: [courseId], references: [id])
  creator     User?        @relation("LessonCreator", fields: [createdBy], references: [id])
  components  Component[]
  userLessons UserLesson[]
}

model Word {
  id          String      @id() @default(cuid())
  description String      @default("")
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt()
  deleted     DateTime?
  content     String      @db.Text()
  meaning     String      @db.Text()
  wordType    WordType
  components  Component[]
}

model Test {
  id               String      @id() @default(cuid())
  description      String      @default("")
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt()
  deleted          DateTime?
  name             String      @db.Text()
  duration         Int
  maxAttempts      Int
  maxScore         Int         @default(10)
  passScore        Int         @default(5)
  shuffleQuestions Boolean     @default(false)
  shuffleAnswers   Boolean     @default(false)
  questions        Question[]
  components       Component[]
}

model MediaFile {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  fileName    String    @db.VarChar(255)
  fileUrl     String    @db.VarChar(500)
  fileType    String    @db.VarChar(50)
  fileSize    Int?
  uploadedBy  String?
  questionId  String?
  fileUri     String?   @db.VarChar(500)
  uploader    User?     @relation("MediaUploader", fields: [uploadedBy], references: [id])
  question    Question? @relation(fields: [questionId], references: [id])
}

model Question {
  id           String       @id() @default(cuid())
  description  String       @default("")
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt()
  deleted      DateTime?
  testId       String
  content      String       @db.Text()
  questionType QuestionType
  points       Int?         @default(1)
  maxLength    Int?
  test         Test         @relation(fields: [testId], references: [id])
  answers      Answer[]
  mediaFiles   MediaFile[]
}

model Answer {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  questionId  String
  content     String    @db.VarChar(255)
  correct     Boolean
  question    Question  @relation(fields: [questionId], references: [id])
}

model Component {
  id            String        @id() @default(cuid())
  description   String        @default("")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt()
  deleted       DateTime?
  lessonId      String
  componentType ComponentType
  testId        String?
  wordId        String?
  videoId       String?
  content       String?       @db.Text()
  indexInLesson Int
  lesson        Lesson        @relation(fields: [lessonId], references: [id])
  test          Test?         @relation(fields: [testId], references: [id])
  word          Word?         @relation(fields: [wordId], references: [id])
  video         VideoContent? @relation(fields: [videoId], references: [id])
  userWords     UserWord[]
  testResults   TestResult[]
  userNotes     UserNote[]
}

model UserCourse {
  id               String          @id() @default(cuid())
  description      String          @default("")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt()
  deleted          DateTime?
  userId           String
  courseId         String
  enrolmentStatus  EnrolmentStatus @default(PENDING)
  progress         Int
  reason           String?         @db.Text()
  startDate        DateTime?       @db.Date()
  endDate          DateTime?       @db.Date()
  extensionRequest Boolean         @default(false)
  user             User            @relation(fields: [userId], references: [id])
  course           Course          @relation(fields: [courseId], references: [id])
}

model UserLesson {
  id          String       @id() @default(cuid())
  description String       @default("")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt()
  deleted     DateTime?
  userId      String
  lessonId    String
  status      LessonStatus @default(TODO)
  grade       Int
  completedAt DateTime?
  user        User         @relation(fields: [userId], references: [id])
  lesson      Lesson       @relation(fields: [lessonId], references: [id])
}

model AdminCourseManager {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  userId      String
  courseId    String
  user        User      @relation(fields: [userId], references: [id])
  course      Course    @relation(fields: [courseId], references: [id])
}

model UserWord {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  userId      String
  componentId String
  user        User      @relation(fields: [userId], references: [id])
  component   Component @relation(fields: [componentId], references: [id])
}

model TestResult {
  id             String           @id() @default(cuid())
  description    String           @default("")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt()
  deleted        DateTime?
  userId         String
  componentId    String
  attemptNumber  Int
  userAnswers    Json
  questionScores Json?
  mark           Int
  status         TestResultStatus
  feedback       String?          @db.Text()
  gradedBy       String?
  gradedAt       DateTime?
  user           User             @relation(fields: [userId], references: [id])
  component      Component        @relation(fields: [componentId], references: [id])
  grader         User?            @relation("GradedBy", fields: [gradedBy], references: [id])
}

model UserNote {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  userId      String
  componentId String
  content     String    @db.Text()
  isPrivate   Boolean   @default(true)
  tags        String?   @db.VarChar(500)
  user        User      @relation(fields: [userId], references: [id])
  component   Component @relation(fields: [componentId], references: [id])

  @@unique([userId, componentId])
}

model VideoContent {
  id             String         @id() @default(cuid())
  description    String         @default("")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt()
  deleted        DateTime?
  title          String         @db.VarChar(255)
  originalFile   String         @db.VarChar(500)
  hlsPlaylistUrl String         @db.VarChar(500)
  thumbnailUrl   String?        @db.VarChar(500)
  duration       Int?
  resolution     String?        @db.VarChar(50)
  fileSize       Int?
  uploadedBy     String?
  processedAt    DateTime?
  uploader       User?          @relation("VideoUploader", fields: [uploadedBy], references: [id])
  components     Component[]
  videoComments  VideoComment[]
}

model VideoComment {
  id          String         @id() @default(cuid())
  description String         @default("")
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt()
  deleted     DateTime?
  videoId     String
  userId      String
  content     String         @db.Text()
  timestamp   Int
  parentId    String?
  isResolved  Boolean        @default(false)
  video       VideoContent   @relation(fields: [videoId], references: [id])
  user        User           @relation("VideoCommenter", fields: [userId], references: [id])
  parent      VideoComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies     VideoComment[] @relation("CommentReplies")

  @@index([videoId, timestamp])
}

model User {
  id                  String               @id() @default(cuid())
  description         String               @default("")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt()
  deleted             DateTime?
  name                String?              @db.VarChar(100)
  email               String               @unique() @db.VarChar(100)
  passwordDigest      String               @db.VarChar(255)
  birthday            DateTime?            @db.Date()
  gender              Gender?
  role                UserRole             @default(USER)
  rememberDigest      String               @default("")
  avatarUrl           String?              @db.VarChar(500)
  phone               String?              @unique()
  locked              Boolean              @default(false)
  loginFailed         Int                  @default(0)
  refreshTokens       RefreshToken[]
  devices             Device[]
  group               UserGroup[]
  userCourses         UserCourse[]
  userLessons         UserLesson[]
  userWords           UserWord[]
  testResults         TestResult[]
  gradedResults       TestResult[]         @relation("GradedBy")
  adminCourseManagers AdminCourseManager[]
  userNotes           UserNote[]
  createdCourses      Course[]             @relation("CourseCreator")
  createdLessons      Lesson[]             @relation("LessonCreator")
  uploadedFiles       MediaFile[]          @relation("MediaUploader")
  uploadedVideos      VideoContent[]       @relation("VideoUploader")
  videoComments       VideoComment[]       @relation("VideoCommenter")

  @@unique([email, phone])
}

model UserGroup {
  id          String       @id() @default(cuid())
  description String       @default("")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt()
  deleted     DateTime?
  name        String       @unique()
  user        User[]
  permission  Permission[]
}

model Permission {
  id             String         @id() @default(cuid())
  description    String         @default("")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt()
  deleted        DateTime?
  name           PermissionName
  permissionType PermissionType
  disabled       Boolean        @default(false)
  groups         UserGroup[]

  @@unique([name, permissionType])
}

model RefreshToken {
  id          String    @id() @default(cuid())
  description String    @default("")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  deleted     DateTime?
  token       String    @unique()
  userId      String
  revoked     Boolean   @default(false)
  user        User      @relation(fields: [userId], references: [id])
  deviceId    String
  device      Device    @relation(fields: [deviceId], references: [id])
  expiresAt   DateTime

  @@unique([userId, deviceId])
}

model Device {
  id           String         @id() @default(cuid())
  description  String         @default("")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt()
  deleted      DateTime?
  name         String
  userId       String
  user         User           @relation(fields: [userId], references: [id])
  lastActive   DateTime?
  isActive     Boolean        @default(true)
  ipAddress    String?
  location     String?
  refreshToken RefreshToken[]

  @@unique([userId, name])
}
